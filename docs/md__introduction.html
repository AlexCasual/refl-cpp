<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>refl-cpp: Introduction to refl-cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">refl-cpp
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__introduction.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction to refl-cpp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>refl-cpp is a new compile-time reflection library targeting C++17 and newer. It works by encoding type metadata in the type system, which allows the user to access that information at compile-time. refl-cpp supports compile-time enumeration of fields and functions, constexpr custom attributes (objects bound to types/fields/functions), template types, proxy objects which resolve function calls at compilation time and much more.</p>
<p>This documents gives tips on how best to utilize refl-cpp for your use case. Please, also refer to the <a href="https://veselink1.github.io/refl-cpp/namespacerefl.html">documentation</a> and <a href="https://github.com/veselink1/refl-cpp/tree/master/examples">examples</a>.</p>
<h2>Basics</h2>
<p>refl-cpp relies on the user to properly specify type metadata through the use of macros.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>A {};</div><div class="line"></div><div class="line">REFL_AUTO(type(A))</div></div><!-- fragment --><ul>
<li>The metadata should be available before it is first requested, and should ideally be put right after the definition of the target type (forward declarations won't work).</li>
</ul>
<h2>Type metadata</h2>
<p>refl-cpp exposes access to the metadata through the <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1type__descriptor.html"><code>type_descriptor&lt;T&gt;</code></a> type. All of the metadata is stored in static fields on the corresponding specialization of that type, but for convenience, objects of the metadata types are typically used in many places, and can be obtained through calling the trivial constructor or through the <a href="https://veselink1.github.io/refl-cpp/namespacerefl.html#ae95fbc2d63a7db5ce4d8a4dcca3d637e"><code>reflect&lt;T&gt;</code></a> family of functions.</p>
<div class="fragment"><div class="line"><span class="comment">// continued from previous example</span></div><div class="line"><span class="keyword">using</span> <a class="code" href="namespacerefl.html#ae95fbc2d63a7db5ce4d8a4dcca3d637e">refl::reflect</a>;</div><div class="line"><span class="keyword">using</span> refl::descriptors::type_descriptor;</div><div class="line"></div><div class="line">constexpr type_descriptor&lt;A&gt; type{};</div><div class="line">constexpr <span class="keyword">auto</span> type = reflect&lt;A&gt;(); <span class="comment">// equivalent</span></div></div><!-- fragment --><p><a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1type__descriptor.html"><code>type_descriptor&lt;T&gt;</code></a> provides access to the target's name, members and attributes.</p>
<div class="fragment"><div class="line">type.name; <span class="comment">// -&gt; const_string&lt;5&gt;{&quot;Point&quot;}</span></div><div class="line">foo.members; <span class="comment">// -&gt; type_list&lt;&gt;{}</span></div><div class="line">foo.attributes; <span class="comment">// -&gt; std::tuple&lt;&gt;{}</span></div></div><!-- fragment --><p><code>name</code> is of type <code>const_string&lt;N&gt;</code> which is a refl-cpp-provided type which allows <code>constexpr</code> string equality, concat and slicing.</p>
<p>In a similar way to type metadata, member metadata is also represented through template specializations. The <code>type_list&lt;Ts...&gt;</code> is an empty trivial template type, which provides a means for passing that list of types through the type system.</p>
<p>Custom attributes are stored in a constexpr <code>std::tuple</code> which is exposed through the metadata descriptor.</p>
<ul>
<li>Since the type <code>A</code> has no members and no attributes defined, <code>members</code> and <code>attribute</code> are of type <code>type_list&lt;&gt;</code>, an empty list of types, and <code>std::tuple&lt;&gt;</code>, an empty tuple, respectively.</li>
</ul>
<h2>Field metadata</h2>
<p>Let's use a the following simple Point type definition to demonstrate how field reflection works.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Point {</div><div class="line">    <span class="keywordtype">int</span> x;</div><div class="line">    <span class="keywordtype">int</span> y;</div><div class="line">};</div><div class="line"></div><div class="line">REFL_AUTO(</div><div class="line">    type(Point),</div><div class="line">    field(x),</div><div class="line">    field(y)</div><div class="line">)</div></div><!-- fragment --><p>Fields are represented through specializations of the <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1field__descriptor.html"><code>field_descriptor&lt;T, N&gt;</code></a>. <code>T</code> is the target type, and <code>N</code> is the index of the reflected member, regardless of the type of that member (field or function). <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1field__descriptor.html"><code>field_descriptor&lt;T, N&gt;</code></a> is never used directly.</p>
<p>There are multiple ways to get a field's descriptor. The easiest one is by using the name of the member together with the <a href="https://veselink1.github.io/refl-cpp/namespacerefl_1_1util.html#a019b3322cffd29fd129b6378ef499668"><code>find_one</code></a> helper. </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="namespacerefl_1_1util.html">refl::util</a>;</div><div class="line">constexpr <span class="keyword">auto</span> type = reflect&lt;Point&gt;();</div><div class="line"></div><div class="line">constexpr <span class="keyword">auto</span> field = <a class="code" href="namespacerefl_1_1util.html#a879e3a3cebc3fdd3a9581fba663cabdf">find_one</a>(type.members, <span class="stringliteral">&quot;x&quot;</span>); <span class="comment">// -&gt; field_descriptor&lt;Point, 0&gt;{...}</span></div></div><!-- fragment --><p>Field descriptors provide access to the field's name, type, const-ness, whether the field is static, a (member) pointer to the field and convenience <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1field__descriptor.html#a5a7ca636e0dea5431786a2dac4f149c4"><code>get()</code></a> and <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1field__descriptor.html#af003db500839f3ca03b9408bcf76b009"><code>operator()</code></a> methods which return references to that field.</p>
<div class="fragment"><div class="line"><span class="comment">// continued from previous example</span></div><div class="line">field.name; <span class="comment">// -&gt; const_string&lt;1&gt;{&quot;x&quot;}</span></div><div class="line">field.attributes; <span class="comment">// -&gt; std::tuple&lt;&gt;{}</span></div><div class="line">field.is_static; <span class="comment">// -&gt; false</span></div><div class="line">field.is_writable; <span class="comment">// -&gt; true (non-const)</span></div><div class="line">field.value_type; <span class="comment">// -&gt; int</span></div><div class="line">field.pointer; <span class="comment">// -&gt; pointer of type int Point::*</span></div><div class="line"></div><div class="line">Point pt{5, -2};</div><div class="line">field.get(pt); <span class="comment">// -&gt; int&amp; (5)</span></div><div class="line">field(pt); <span class="comment">// -&gt; int&amp; (5)</span></div></div><!-- fragment --><p>As with <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1type__descriptor.html"><code>type_descriptor&lt;T&gt;</code></a>, all of the metadata is exposed through constexpr static fields and functions, but an object is used to access those for convenience purposes and because objects can be passed to functions as values as well.</p>
<ul>
<li>Since the field <code>Point::x</code> in this example has no custom attributes associated with it, the <code>field.attributes</code> in the example above will be generated as <code>static constexpr std::tuple&lt;&gt;{}</code>.</li>
</ul>
<h2>Function metadata</h2>
<p>We will be using the following type definition for the below examples.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Circle {</div><div class="line">    <span class="keywordtype">double</span> r;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Circle(<span class="keywordtype">double</span> r) : r() {}</div><div class="line">    <span class="keywordtype">double</span> radius() <span class="keyword">const</span>;</div><div class="line">    <span class="keywordtype">double</span> diameter() <span class="keyword">const</span>;</div><div class="line">    <span class="keywordtype">double</span> area() <span class="keyword">const</span>;</div><div class="line">};</div><div class="line"></div><div class="line">REFL_AUTO(</div><div class="line">    type(Circle),</div><div class="line">    func(radius),</div><div class="line">    func(diameter),</div><div class="line">    func(area)</div><div class="line">)</div></div><!-- fragment --><p>Like fields, functions are represented through specializations of a "descriptor" type, namely, <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1function__descriptor.html"><code>function_descriptor&lt;T, N&gt;</code></a>. <code>T</code> is the target type, and <code>N</code> is the index of the reflected member, regardless of the type of that member (field or function). <a href="https://veselink1.github.io/refl-cpp/classrefl_1_1descriptor_1_1function__descriptor.html"><code>function_descriptor&lt;T, N&gt;</code></a> is never used directly.</p>
<p>There are multiple ways to get a function's descriptor. The easiest one is by using the name of the member together with the <a href="https://veselink1.github.io/refl-cpp/namespacerefl_1_1util.html#a019b3322cffd29fd129b6378ef499668"><code>find_one</code></a> helper.</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="namespacerefl_1_1util.html">refl::util</a>;</div><div class="line">constexpr <span class="keyword">auto</span> type = reflect&lt;Circle&gt;();</div><div class="line"></div><div class="line">constexpr <span class="keyword">auto</span> func = <a class="code" href="namespacerefl_1_1util.html#a879e3a3cebc3fdd3a9581fba663cabdf">find_one</a>(type.members, <span class="stringliteral">&quot;radius&quot;</span>); <span class="comment">// -&gt; function_descriptor&lt;Circle, 0&gt;{...}</span></div></div><!-- fragment --><p>Function descriptors expose a number of properties to the user.</p>
<div class="fragment"><div class="line"><span class="comment">// continued from previous example</span></div><div class="line">func.name; <span class="comment">// -&gt; const_string&lt;6&gt;{&quot;radius&quot;}</span></div><div class="line">func.attributes; <span class="comment">// -&gt; std::tuple&lt;&gt;{}</span></div><div class="line">func.is_resolved; <span class="comment">// -&gt; true</span></div><div class="line">func.pointer; <span class="comment">// -&gt; pointer of type double (Circle::* const)()</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> radius_t = double (Circle::* <span class="keyword">const</span>)();</div><div class="line">func.template resolve&lt;radius_t&gt;; <span class="comment">// -&gt; pointer of type radius_t on success, nullptr_t on fail.</span></div><div class="line"></div><div class="line">Circle c(2.0);</div><div class="line">func.invoke(c); <span class="comment">// -&gt; the result of c.radius()</span></div></div><!-- fragment --><p>Function descriptors can be tricky as they represent a "group" of functions with the same name. Overload resolution is done by the <code>resolve</code> or <code>invoke</code> functions of <code>function_descriptor</code>. Only when the function is not overloaded is <code>pointer</code> available (<code>nullptr</code> otherwise). A call to <code>resolve</code> is needed to get a pointer to a specific overload. A call to <code>resolve</code> is <b>not</b> needed to <code>invoke</code> the target function. The <code>(*this)</code> object must be passed as the first argument when a member function is invoked. When invoking a static function, simply provide the arguments as usual.</p>
<h2>Custom Attributes</h2>
<p>TOOD</p>
<h2>Proxies</h2>
<p>TODO </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
